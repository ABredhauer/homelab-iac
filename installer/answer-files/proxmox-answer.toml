# File: installer/answer-files/proxmox-answer.toml
# Proxmox VE 9.0 Automated Installation Answer File
# Single file works for both Dell OptiPlex nodes

[global]
# Keyboard and regional settings
keyboard = "us"                           # US keyboard layout
country = "au"                           # Australia for mirror selection
timezone = "Australia/Brisbane"          # Your correct timezone

# Network/system identification (will be changed post-install)
fqdn = "pve-temp.homelab.local"         # Temporary - post-install script changes this
mailto = "admin@homelab.local"          # Email for system alerts

# Root password - gets locked by post-install script
root-password = "TempInstall2024!"      # Changed to SSH-key only post-install

[network]
# Network configuration for installation
# DHCP will assign IP and provide your Pi-hole DNS automatically
source = "from-dhcp"                    # Let DHCP handle IP, DNS, gateway
# Note: Post-install script will configure bonding and VLANs

[disk-setup]
# Disk selection and partitioning configuration
# This section is critical and hard to change after installation

# Filesystem type - you were correct to put this here!
filesystem = "ext4"                      # Options: ext4, xfs, zfs, btrfs

# Disk selection strategy
disk-list = ["*"]                       # Select any available disk
                                       # Alternatives:
                                       # ["/dev/sda"] - specific disk
                                       # ["/dev/nvme0n1"] - specific NVMe
                                       # ["*SAMSUNG*"] - match by model

filter-match = "any"                   # Use first disk found that matches
                                       # "any" = use any disk from disk_list
                                       # "all" = all disks must match (for RAID)

# LVM configuration - you were right about the prefix!
lvm.hdsize = 900                       # Total disk space to use (GB)
                                       # Leave ~100GB unallocated for SSD health

lvm.swapsize = 8                       # Swap size (GB) - 8GB for 32GB RAM

lvm.maxroot = 100                      # Maximum root volume size (GB)
                                       # Contains: OS, applications, logs

lvm.maxvz = 792                        # Maximum data volume size (GB)  
                                       # This is where VMs and containers live
                                       # 792GB = 900 - 100 (root) - 8 (swap)

lvm.minfree = 16                       # Minimum free space in volume group (GB)
                                       # Reserve for snapshots and expansion

# Final layout on your 1TB SSD will be approximately:
# - /dev/sda1: 1GB (EFI boot partition)
# - /dev/sda2: 900GB (LVM Physical Volume)
#   - pve-swap: 8GB (swap logical volume)
#   - pve-root: 100GB (root filesystem - OS)
#   - pve- 792GB (VM/CT storage)
#   - free: 16GB (reserved LVM space)
# - Unallocated: ~99GB (SSD over-provisioning + wear leveling)

[first-boot]
# Execute bootstrap script on first boot after installation completes
source = "from-url"
url = "https://raw.githubusercontent.com/ABredhauer/homelab-iac/main/scripts/bootstrap/secure-first-boot.sh"

# Optional: Add error handling
# If the script fails, what should happen?
# Options: "continue", "abort" 
on-error = "continue"                  # Continue booting even if script fails